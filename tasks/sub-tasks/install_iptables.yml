---
- name: install required packages
  ansible.builtin.package:
    state: present
    name: "{{ pkg }}"
  loop: "{{ iptables_packages | flatten }}"
  loop_control:
    loop_var: pkg

- name: create empty default saved ipv4 rules file
  ansible.builtin.file:
    path: "{{ iptables_conf_v4 }}"
    state: touch
    mode: 600
    owner: root
    group: root

- name: create empty default saved ipv6 rules file
  ansible.builtin.file:
    path: "{{ iptables_conf_v6 }}"
    state: touch
    mode: 600
    owner: root
    group: root

- name: disable and stop un-required services
  ansible.builtin.systemd:
    state: stopped
    enabled: false
    name: "{{ service }}"
    daemon_reload: true
  loop: "{{ iptables_services_off | flatten }}"
  loop_control:
    loop_var: service
  ignore_errors: true

- name: enable and start required services
  ansible.builtin.systemd:
    state: started
    enabled: true
    name: "{{ service }}"
    daemon_reload: true
  loop: "{{ iptables_services_on | flatten }}"
  loop_control:
    loop_var: service
  ignore_errors: true
